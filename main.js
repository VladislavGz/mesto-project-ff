(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),e.addEventListener("click",n),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",n),document.removeEventListener("keydown",o)}function n(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&t(e.currentTarget)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function r(e,t,n,o,r){var c=e.cloneNode(!0),i=c.querySelector(".card__title"),a=c.querySelector(".card__image"),u=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-counter");return i.textContent=t.name,l.textContent=t.likes,a.setAttribute("src",t.link),a.setAttribute("alt","Фото: ".concat(t.name)),t.isLike&&s.classList.add("card__like-button_is-active"),t.isOwner?u.addEventListener("click",(function(){n(c,t.cardId)})):(u.disabled=!0,u.classList.add("card__delete-button_disabled")),s.addEventListener("click",(function(){o(s.classList.contains("card__like-button_is-active"),t.cardId,{likeBtn:s,likeCounter:l})})),a.addEventListener("click",(function(){r({src:t.link,alt:"Фото: ".concat(t.name),txt:t.name})})),c}function c(e,t,n){t?e.likeBtn.classList.add("card__like-button_is-active"):e.likeBtn.classList.remove("card__like-button_is-active"),e.likeCounter.textContent=n}function i(e,t){for(var n=0;n<t.likes.length;n++)if(t.likes[n]._id===e)return!0;return!1}function a(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function u(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function s(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){a(e,n,t)})),u(o,t)}var l={baseUrl:"https://nomoreparties.co/v1/",cohortId:"wff-cohort-8",headers:{authorization:"e90a88de-4d84-48ee-a98b-66385728ff23","Content-Type":"application/json"}};function p(e){return e.ok?e.json():Promise.reject()}var d=document.querySelector("#card-template").content.querySelector(".card"),_=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),m=document.querySelector(".profile__image"),v=document.querySelector(".places__list"),h=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=b.querySelector(".popup__image"),k=b.querySelector(".popup__caption"),L=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_edit-avatar"),E=h.querySelector(".popup__form"),g=E.elements.name,B=E.elements.description,A=y.querySelector(".popup__form"),I=A.elements["place-name"],x=A.elements.link,U=C.querySelector(".popup__form"),w=U.elements.link;function T(e){m.setAttribute("style",'background-image: url("'.concat(e,'")'))}function O(e){e.querySelector(".popup__button_loading-element").classList.add("popup__button_loading-element_active")}function P(e){e.querySelector(".popup__button_loading-element").classList.remove("popup__button_loading-element_active")}function D(t){S.setAttribute("src",t.src),S.setAttribute("alt",t.alt),k.textContent=t.txt,e(b)}function N(e,t){_.textContent=e,f.textContent=t}function j(){A.reset(),s(y.querySelector(".popup__form"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"}),e(y)}function J(e,t,n){e?function(e){return fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return p(e)}))}(t).then((function(e){c(n,!1,e.likes.length)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return p(e)}))}(t).then((function(e){c(n,!0,e.likes.length)})).catch((function(e){console.log(e)}))}function H(e,t){(function(e){return fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return p(e)}))})(t).then((function(){!function(e){e.remove()}(e)})).catch((function(e){console.log(e)}))}h.classList.add("popup_is-animated"),y.classList.add("popup_is-animated"),b.classList.add("popup_is-animated"),C.classList.add("popup_is-animated"),L.addEventListener("click",(function(){g.value=_.textContent,B.value=f.textContent,s(h.querySelector(".popup__form"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"}),e(h)})),E.addEventListener("submit",(function(e){var n;e.preventDefault(),O(h),(n={name:g.value,about:B.value},fetch("".concat(l.baseUrl).concat(l.cohortId,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify(n)}).then((function(e){return p(e)}))).then((function(e){N(e.name,e.about),t(h)})).catch((function(e){console.log(e)})).finally((function(){P(h)}))})),q.addEventListener("click",j),A.addEventListener("submit",(function(e){var n;e.preventDefault(),O(y),(n={name:I.value,link:x.value},fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify(n)}).then((function(e){return p(e)}))).then((function(e){var n={name:e.name,link:e.link,likes:e.likes.length,cardId:e._id,isOwner:!0,isLike:!1};v.prepend(r(d,n,H,J,D)),t(y)})).catch((function(e){console.log(e)})).finally((function(){P(y)}))})),m.addEventListener("click",(function(){U.reset(),s(C.querySelector(".popup__form"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"}),e(C)})),U.addEventListener("submit",(function(e){var n;e.preventDefault(),O(C),(n={avatar:w.value},fetch("".concat(l.baseUrl).concat(l.cohortId,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify(n)}).then((function(e){return p(e)}))).then((function(e){T(e.avatar),t(C)})).catch((function(e){console.log(e)})).finally((function(){P(C)}))})),document.addEventListener("keydown",(function(e){"+"!==e.key||j()}));var M,z=fetch("".concat(l.baseUrl).concat(l.cohortId,"/users/me"),{headers:l.headers}).then((function(e){return p(e)})),F=fetch("".concat(l.baseUrl).concat(l.cohortId,"/cards"),{headers:l.headers}).then((function(e){return p(e)}));Promise.all([z,F]).then((function(e){T(e[0].avatar),N(e[0].name,e[0].about);var t=e[0]._id;e[1].forEach((function(e){var n=e.owner._id,o={name:e.name,link:e.link,likes:e.likes.length,cardId:e._id,isOwner:t===n,isLike:i(t,e)};v.append(r(d,o,H,J,D))}))})).catch((function(e){console.log(e)})),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(M.formSelector)).forEach((function(e){var t=Array.from(e.querySelectorAll(M.inputSelector)),n=e.querySelector(M.submitButtonSelector);t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){if(t.validity.valid)a(e,t,n);else{var o=t.validationMessage;t.validity.patternMismatch&&(o=t.getAttribute("data-pattern-err-msg")),function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,o,n)}}(e,o,M),function(e,t,n){!function(e){return e.every((function(e){return e.validity.valid}))}(n)?u(e,t):function(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}(e,t)}(n,M,t)}))}))}))})();